<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- General structure of a workflow XML file -->
        <record model="workflow" id="wkf_job">
            <field name="name">workflow.job</field>
            <field name="osv">fleet.vehicle.log.services</field>
            <field name="on_create">True</field>
        </record>

        <!-- Job Workflow Activities -->
        <record model="workflow.activity" id="act_draft">
            <field name="wkf_id" ref="wkf_job" />
            <field name="name">activity.draft</field>
            <field name="flow_start">True</field>
        </record>

        <record model="workflow.activity" id="act_observation">
            <field name="wkf_id" ref="wkf_job" />
            <field name="name">activity.observation</field>
            <field name="kind">function</field>
            <field name="action">write({'state': 'observation'})</field>
        </record>

        <record model="workflow.activity" id="act_inprogress">
            <field name="wkf_id" ref="wkf_job" />
            <field name="name">activity.inprogress</field>
            <field name="kind">subflow</field>
            <field name="subflow_id" search="[('name','=','stock.picking.basic')]"/>
            <field name="action">action_picking_create()</field>
        </record>

        <record model="workflow.activity" id="act_repair">
            <field name="wkf_id" ref="wkf_job" />
            <field name="name">activity.repair</field>
            <field name="kind">function</field>
            <field name="action">write({'state': 'repair'})</field>
        </record>

        <record model="workflow.activity" id="act_done">
            <field name="wkf_id" ref="wkf_job" />
            <field name="name">activity.done</field>
            <field name="kind">function</field>
            <field name="action">write({'state': 'done'})</field>
        </record>

        <record model="workflow.activity" id="act_cancel">
            <field name="wkf_id" ref="wkf_job" />
            <field name="name">activity.cancel</field>
            <field name="kind">function</field>
            <field name="action">write({'state': 'cancel'})</field>
        </record>

        <record model="workflow.activity" id="act_inspection">
            <field name="wkf_id" ref="wkf_job" />
            <field name="name">activity.inspection</field>
            <field name="kind">function</field>
            <field name="action">write({'state': 'inspection'})</field>
        </record>

        <record model="workflow.activity" id="act_delivered">
            <field name="wkf_id" ref="wkf_job"/>
            <field name="name">activity.delivered</field>
            <field name="flow_stop">True</field>
            <field name="kind">function</field>
            <field name="action">write({'state': 'delivered'})</field>
        </record>

        <!-- Job Workflow Transitions -->
        <record model="workflow.transition" id="trans_draft_observation">
            <field name="act_from" ref="act_draft"/>
            <field name="act_to" ref="act_observation"/>
            <field name="signal">job_observation</field>
        </record>

        <record model="workflow.transition" id="trans_observation_inprogress">
            <field name="act_from" ref="act_observation"/>
            <field name="act_to" ref="act_inprogress"/>
            <field name="signal">job_inprogress</field>
        </record>

        <record model="workflow.transition" id="trans_observation_repair">
            <field name="act_from" ref="act_observation"/>
            <field name="act_to" ref="act_repair"/>
            <field name="signal">repair</field>
        </record>

        <record model="workflow.transition" id="trans_observation_cancel">
            <field name="act_from" ref="act_observation"/>
            <field name="act_to" ref="act_cancel"/>
            <field name="signal">job_cancel</field>
        </record>

        <record model="workflow.transition" id="trans_inprogress_repair">
            <field name="act_from" ref="act_inprogress"/>
            <field name="act_to" ref="act_repair"/>
            <field name="signal">subflow.done</field>
        </record>

        <record model="workflow.transition" id="trans_repair_done">
            <field name="act_from" ref="act_repair"/>
            <field name="act_to" ref="act_done"/>
            <field name="signal">job_done</field>
        </record>

        <record model="workflow.transition" id="trans_done_inspection">
            <field name="act_from" ref="act_done"/>
            <field name="act_to" ref="act_inspection"/>
            <field name="signal">job_inspection</field>
        </record>

        <record model="workflow.transition" id="trans_inspection_delivered">
            <field name="act_from" ref="act_inspection"/>
            <field name="act_to" ref="act_delivered"/>
            <field name="signal">job_delivered</field>
        </record>

        <record model="workflow.transition" id="trans_cancel_delivered">
            <field name="act_from" ref="act_cancel"/>
            <field name="act_to" ref="act_delivered"/>
            <field name="signal">job_delivered</field>
        </record>

    </data>
</openerp>
