<openerp>
  <data>

    <record id="view_location_form_inherit" model="ir.ui.view">
      <field name="name">stock.location.form</field>
      <field name="model">stock.location</field>
      <field name="inherit_id" ref="stock.view_location_form"/>
      <field name="arch" type="xml">
        <field name="scrap_location" position="before">
          <field name="indent_allowed"/>
        </field>
      </field>
    </record>

    <record id="stock_picking_type_form" model="ir.ui.view">
      <field name="name">stock.picking.type.form</field>
      <field name="model">stock.picking.type</field>
      <field name="inherit_id" ref="stock.view_picking_type_form"/>
      <field name="arch" type="xml">
        <xpath expr="//sheet" position="after">
          <div class="oe_chatter">
            <field name="message_follower_ids" widget="mail_followers" />
            <field name="message_ids" widget="mail_thread" />
          </div>
        </xpath>
      </field>
    </record>

    <record id="stock_picking_type_kanban" model="ir.ui.view">
      <field name="name">stock.picking.type.kanban</field>
      <field name="model">stock.picking.type</field>
      <field name="inherit_id" ref="stock.stock_picking_type_kanban"/>
      <field name="arch" type="xml">
        <xpath expr="//button[@name='get_action_picking_tree_ready']" position="after">
          <field name="indent_allowed" invisible="1"/>
          <field name="indent_count" invisible="1"/>
          <button class="btn btn-primary" name="get_indents" type="object" attrs="{'invisible': [('indent_allowed','!=',True)]}">
          <t t-esc="record.indent_count.value"/>
            Indents
          </button>
        </xpath>
        <xpath expr="//button[@name='get_action_picking_tree_ready']" position="attributes">
          <attribute name="attrs">
            {'invisible': [('indent_allowed','=',True)]}
          </attribute>
        </xpath>
      </field>
    </record>

    <!-- Project Settings -->
    <record id="view_account_analytic_account_form" model="ir.ui.view">
      <field name="name">account.analytic.account.inherit</field>
      <field name="model">account.analytic.account</field>
      <field name="inherit_id" ref="analytic.view_account_analytic_account_form" />
      <field name="arch" type="xml">
        <xpath expr="//group[@name='main']" position="inside">
          <group>
            <field name="indent_close" />
            <field name="purchase_close" />
          </group>
        </xpath>
      </field>
    </record>

    <!-- indent list view -->
    <record model="ir.ui.view" id="indent.list">
      <field name="name">stock.indent.list</field>
      <field name="model">stock.indent</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name"/>
          <field name="date_indent"/>
          <field name="date_required"/>
          <field name="picking_type_id" invisible="1"/>
          <field name="user_id"/>
          <field name="analytic_account_id" invisible="1"/>
          <field name="indent_type"/>
          <field name="state"/>
        </tree>
      </field>
    </record>

    <!-- Indent Form View -->
    <record id='view_stock_indent_indent_form' model='ir.ui.view'>
      <field name="name">stock.indent.form</field>
      <field name="model">stock.indent</field>
      <field name="arch" type="xml">
        <form string="Indent" version="9.0">
          <header>
            <button name="action_confirm" string="Confirm" type="object" states="draft" class="oe_highlight"/>
            <button name="action_approve" string="Approve" type="object" states="waiting_approval" groups="indent.stock_indent_manager" class="oe_highlight"/>
            <button name="action_reject" string="Reject" type="object" states="waiting_approval" groups="indent.stock_indent_manager"/>
            <button name="action_cancel" string="Cancel" type="object" states="waiting_approval" groups="indent.stock_indent_manager"/>
            <button name="action_receive_products" string="Issue Items" states="inprogress" type="object" class="oe_highlight" groups="stock.group_stock_user"/>
            <field name="state" widget="statusbar" statusbar_visible="draft,waiting_approval,inprogress,received" statusbar_colors='{"reject":"red"}' />
          </header>
          <sheet>
            <div class="oe_title">
              <h1>
                <field name="name" class="oe_inline" readonly="1"/>
              </h1>
            </div>
            <div class="oe_right oe_inline" name="buttons">
            </div>
            <group>
              <group>
                <field name="indent_type" invisible="1"/>
                <field name="picking_type_id" domain="[('indent_allowed','=',True)]" required="1"/>
                <field name="location_id" domain="[('usage', '=', 'production')]" invisible="1"/>
                <field name="analytic_account_id" domain="[('indent_close','=',False)]" groups="purchase.group_analytic_accounting"/>
              </group>
              <group>
                <field name="date_indent" />
                <field name="date_required" />
                <field name="date_approve" readonly="1"/>
              </group>
            </group>

            <notebook>
              <page string="Products">
                <field name="line_ids" colspan="4" nolabel="1" attrs="{'readonly': [('state', 'in', ('received','inprogress'))]}">
                  <tree editable="bottom" decoration-info="state=='received'">
                    <field name="product_id" />
                    <field name="produre_type" invisible="1"/>
                    <field name="name" />

                    <field name="product_qty" />
                    <field name="product_uom" groups="product.group_uom"/>
                    <field name="product_available_qty" />
                    <field name="product_issued_qty" />

                    <field name="price_unit" groups="stock.group_stock_manager"/>
                    <field name="price_subtotal" groups="stock.group_stock_manager"/>
                    <field name="state" invisible="1"/>
                  </tree>
                </field>

                <group class="oe_subtotal_footer oe_right" groups="stock.group_stock_manager">
                  <field name="items" />
                  <field name="amount_total" widget="monetary"
                    options="{'currency_field': 'currency_id'}" groups="stock.group_stock_manager"/>
                </group>

                <div class="oe_clear">
                  <label for="description" />
                </div>
                <field name="description" class="oe_inline" placeholder="Additional note..." />
              </page>

              <page string="Others">
                <group>
                  <group>
                    <field name="warehouse_id" />
                    <field name="move_type" />
                  </group>
                  <group>
                    <field name="user_id" readonly="1" />
                    <field name="approve_user_id" />
                  </group>
                </group>
              </page>
            </notebook>
          </sheet>
          <div class="oe_chatter">
            <field name="message_follower_ids" widget="mail_followers" />
            <field name="message_ids" widget="mail_thread" />
          </div>
        </form>
      </field>
    </record>

    <record id="view_stock_indent_indent_search" model="ir.ui.view">
      <field name="name">stock.indent.search</field>
      <field name="model">stock.indent</field>
      <field name="arch" type="xml">
        <search string="Indent List">
          <field name="picking_type_id"/>
        </search>
      </field>
    </record>

    <!-- indent action -->
    <record model="ir.actions.act_window" id="indent.action_window">
      <field name="name">Indents</field>
      <field name="res_model">stock.indent</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_stock_indent_indent_search"/>
      <field name="context">{'search_default_picking_type_id':[active_id]}</field>
      <field name="domain">[('picking_type_id','=',active_id)]</field>
    </record>

    <record model="ir.actions.act_window" id="my_indent_action_window_menu">
      <field name="name">My Indents</field>
      <field name="res_model">stock.indent</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_stock_indent_indent_search"/>
      <field name="domain">[('user_id','=',uid)]</field>
    </record>

    <record model="ir.actions.act_window" id="indent_to_approve_action_window_menu">
      <field name="name">Indents to Approve</field>
      <field name="res_model">stock.indent</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_stock_indent_indent_search"/>
      <field name="domain">[]</field>
    </record>
    
    <!-- indent menu -->
    <menuitem name="Indent" id="indent.menu_root" parent="stock.menu_stock_root" sequence="2"/>

    <menuitem name="My Indents" id="menu_my_indent" parent="indent.menu_root"
      action="my_indent_action_window_menu"/>
    <menuitem name="Indents to Approve" id="menu_my_indent_to_approve" parent="indent.menu_root"
      action="indent_to_approve_action_window_menu" groups="indent.stock_indent_manager"/>
  </data>
</openerp>