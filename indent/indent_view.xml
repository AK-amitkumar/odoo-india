<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <!-- Purchase Order Search View -->
        <record id="view_purchase_order_inherited_search" model="ir.ui.view">
            <field name="name">purchase.order.search.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
            <field name="arch" type="xml">
               <filter string="Source" position="attributes">
                    <attribute name="string">Indent</attribute>
                </filter>
               <field name="create_uid" position="after">
                    <field name="indent_id"/>
                    <field name="processed_po" domain="[('processed_po','=', True)]"/>
                </field>
            </field>
        </record>

        <!-- Purchase Order Link with Indent action -->
        <record model="ir.actions.act_window" id="action_purchase_order_indent_view">
            <field name="context">{'search_default_indent_id': active_id,'search_default_processed_po': True}</field>
            <field name="name">Purchase Order</field>
            <field name="res_model">purchase.order</field>
            <field name="search_view_id" ref="view_purchase_order_inherited_search"/>
        </record>

        <!-- Purchase Requisition Search View -->
        <record id="view_purchase_requisition_inherited_search" model="ir.ui.view">
            <field name="name">purchase.requisition.search.inherit</field>
            <field name="model">purchase.requisition</field>
            <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_filter"/>
            <field name="arch" type="xml">
                <field name="user_id" position="after">
                    <field name="indent_id"/>
                </field>
            </field>
        </record>

        <!-- Purchase Requisiton Link with Indent action -->
        <record model="ir.actions.act_window" id="action_purchase_requisition_indent_view">
            <field name="context">{'search_default_indent_id': active_id}</field>
            <field name="name">Purchase Requisition</field>
            <field name="res_model">purchase.requisition</field>
            <field name="search_view_id" ref="view_purchase_requisition_inherited_search"/>
        </record>

        <!-- Indent Form View -->
        <record id='view_indent_indent_form' model='ir.ui.view'>
            <field name="name">indent.indent.form</field>
            <field name="model">indent.indent</field>
            <field name="arch" type="xml">
                <form string="Indents" version="7.0">
                    <header>
                        <button name="indent_confirm" string="Confirm" states="draft" class="oe_highlight"/>
                        <button name="indent_inprogress" string="Approve" states="waiting_approval" class="oe_highlight"/>
                        <button name="indent_reject" string="Reject" states="waiting_approval"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,waiting_approval,inprogress,received" statusbar_colors='{"reject":"red"}'/>
                    </header>
                    <sheet>
                    	<div class="oe_title">
	                        <h1>
	                            <label string="Draft Indent" attrs="{'invisible': [('state','&lt;&gt;','draft')]}"/>
                                <label string="Indent" attrs="{'invisible': [('state', '=', 'draft')]}"/>
	                            <field name="name" class="oe_inline"/>
	                        </h1>
                        </div>
                                <field name="requisition_done" invisible="1"/>
                                <field name="purchase_count" invisible="1"/>
                               	<field name="shipment_done" invisible="1"/>
	                    <div class="oe_right oe_inline" name="buttons">
	  	                    <button name="%(action_purchase_requisition_indent_view)d" string="Enquiry" type="action" groups="purchase.group_purchase_user"/> 
                            <button name="process_purchase_order" string="Process Purchase Orders" type="object" groups="purchase.group_purchase_user" attrs="{'invisible': ['|',('purchase_count', '=', True),('requisition_done','=',False)]}"/>
							<button name="action_receive_products" string="Inward" attrs="{'invisible': [('purchase_count', '=', False)]}" type="object"/>
                            <button name="action_issue_receipt" string="Issue Reciept(s)" attrs="{'invisible': [('shipment_done','=',False)]}" type="object" groups="purchase.group_purchase_user"/>  
	                        <button name="%(action_purchase_order_indent_view)d" string="Purchase Orders" type="action" groups="purchase.group_purchase_user" attrs="{'invisible': [('state', '!=', 'inprogress'),'|',('type', '!=', 'existing'),'|',('requisition_done', '=', False)]}"/>
	                        	
                        </div>
                        <group>
                            <group>
                                <field name="indent_date" />
                                <field name="maize" groups="indent.group_maize_data"/>
                            </group>
                            <group>
                                <field name="required_date"/>
                                <field name="attachment_id" invisible="1"/>
                                <field name="print_report" readonly="1" attrs="{'invisible': [('print_report', '=', False)]}"/>
                            </group>
                        </group>
                        <group>
                            <group string="Details">
                                <field name="item_for" on_change="onchange_item(item_for)"/>
                                <field name="analytic_account_id" attrs="{'invisible': [('item_for', '!=', 'capital')], 'required': [('item_for', '=', 'capital')]}"/>
                                <field name="requirement"/>
                                <field name="type"/>
                                <field name="company_id" invisible="1"/>
                            </group>
                            <group string="Indentor">
                                <field name="indentor_id" readonly="1"/>
                                <field name="employee_id" groups="indent.group_maize_data" invisible="1"/>
                                <field name="employee_department_id" groups="indent.group_maize_data" invisible="1"/>
                                <field name="department_id" domain="[('location_id', '!=', False), ('usage', '!=', 'view'), ('maize_location', '=', True)]" context="{'default_maize_location': True}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Products">
                                <field name="product_lines">
                                    <form string="Products" version="7.0">
                                        <group>
                                            <group>
                                                <field name="product_id"
                                                    groups="base.group_user"
                                                    on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                                <label for="product_uom_qty"/>
                                                <div>
                                                    <field
                                                        name="product_uom_qty" class="oe_inline"/>
                                                    <field name="product_uom" groups="product.group_uom" class="oe_inline oe_no_button"
                                                        on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                                </div>
                                                 <field name="price_unit" on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                            </group>
                                            <group>
                                                <field name="original_product_id"/>
                                                <field name="type"/>
                                                <field name="qty_available" on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                                <field name="virtual_available" on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                            </group>
                                        </group>
                                        <label for="name"/>
                                        <field name="name"/>
                                        <label for="specification"/>
                                        <field name="specification"/>
                                    </form>
                                    <tree string="Products">
                                        <field name="product_id"
                                            groups="base.group_user"
                                            on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                        <field name="product_uom" string="Unit"
                                            on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"
                                            groups="product.group_uom" options='{"no_open": True}'/>
                                        <field name="qty_available" on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                        <field name="product_uom_qty"/>
                                        <field name="name"/>
                                        <field name="specification"/>
                                        <field name="price_unit" on_change="onchange_product_id(product_id, product_uom_qty, product_uom, price_unit, qty_available, virtual_available, name, parent.analytic_account_id, parent.type)"/>
                                        <field name="price_subtotal"/>
                                    </tree>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="amount_total"/>
                                </group>
                            </page>
                            <page string="Status">
                                <field name="indent_authority_ids" readonly="1">
                                    <tree string="Status" editable="bottom">
                                        <field name="date"/>
                                        <field name="name"/>
                                        <field name="priority"/>
                                        <field name="description"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                        <label for="description"/>
                        <field name="description"/>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Indent Tree View -->
        <record id='view_indent_indent_tree' model='ir.ui.view'>
            <field name="name">indent.indent.tree</field>
            <field name="model">indent.indent</field>
            <field name="arch" type="xml">
                <tree string="Indents" colors="gray:state=='received';red:shipment_done==True;green:purchase_count==True;green:state=='waiting_approval';">
                    <field name="name"/>
                    <field name="indentor_id"/>
                    <field name="indent_date"/>
                    <field name="required_date"/>
                    <field name="department_id"/>
                    <field name="analytic_account_id"/>
                    <field name="requirement"/>
                    <field name="type"/>
                    <field name="shipment_done" invisible="1"/>
                    <field name="purchase_count" invisible="1"/>
                    <field name="requisition_done" invisible="1"/>
                    <field name="amount_total"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Indent Search View -->
        <record id="view_indent_indent_search" model="ir.ui.view">
            <field name="name">indent.indent.search</field>
            <field name="model">indent.indent</field>
            <field name="arch" type="xml">
                <search string="Indents">
                    <field name="name" string="Indent Name"/>
                    <field name="indent_date"/>
                    <field name="required_date"/>
                    <filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                    <filter string="Waiting For Approval" name="waiting" domain="[('state','=','waiting_approval')]"/>
                    <filter string="Inprogress" name="inprogress" domain="[('state','=','inprogress')]"/>
                    <filter string="Received" name="received" domain="[('state','=','received')]"/>
                    <filter string="Rejected" name="reject" domain="[('state','=','reject'),('active','=',False)]"/>
                    <field name="indentor_id"/>
                    <field name="department_id"/>
                    <field name="analytic_account_id"/>
                    <group expand="0" string="Group By...">
                        <filter string="Indentor" context="{'group_by': 'indentor_id'}"/>
                        <filter string="Department" context="{'group_by': 'department_id'}"/>
                        <filter string="Project" context="{'group_by': 'analytic_account_id'}"/>
                        <filter string="Requirement" context="{'group_by': 'requirement'}"/>
                        <filter string="Indent Type" context="{'group_by': 'type'}"/>
                        <filter string="Date" context="{'group_by': 'indent_date'}"/>
                        <filter string="Status" context="{'group_by': 'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Indent Action -->
        <record id='action_indent_indent' model='ir.actions.act_window'>
            <field name="name">Indents</field>
            <field name="res_model">indent.indent</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_waiting': 1}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to create a new indent.
                </p>
            </field>
        </record>

        <!-- Indent Menu -->
        <menuitem name="Indents" parent="stock.menu_stock_root" id="menu_indent_indent_main" sequence="1"/>
        <menuitem action="action_indent_indent" name="Indents" parent="menu_indent_indent_main" id="menu_indent_indent" sequence="1"/>
        <menuitem id="stock.menu_stock_warehouse_mgmt" name="Receive/Deliver By Orders" parent="stock.menu_stock_root" sequence="2"/>
        <menuitem id="stock.menu_stock_products_moves" name="Receive/Deliver Products" parent="stock.menu_stock_root" sequence="3"/>

        <!-- Document Authority Form View -->
        <record id="view_document_authority_form" model="ir.ui.view">
            <field name="name">document.authority.form</field>
            <field name="model">document.authority</field>
            <field name="arch" type="xml">
                <form string="Document Authority" version="7.0">
                    <sheet>
                        <group>
                            <group>
                                <field name="document"/>
                                <field name="name"/>
                            </group>
                            <group>
                                <field name="priority"/>
                                <field name="active"/>
                            </group>
                        </group>
                        <label for="description"/>
                        <field name="description"/>
                    </sheet>
                </form>
            </field>
        </record>

         <!-- Document Authority Tree View -->
         <record id='view_document_authority_tree' model='ir.ui.view'>
             <field name="name">document.authority.tree</field>
             <field name="model">document.authority</field>
             <field name="arch" type="xml">
                 <tree string="Document Authorities" editable="bottom">
                     <field name="document"/>
                     <field name="name"/>
                     <field name="priority"/>
                     <field name="description"/>
                 </tree>
             </field>
         </record>

         <!-- Document Authority Action -->
         <record id='action_document_authority' model='ir.actions.act_window'>
             <field name="name">Document Authorities</field>
             <field name="res_model">document.authority</field>
             <field name="view_type">form</field>
             <field name="view_mode">tree,form</field>
             <field name="help" type="html">
                 <p class="oe_view_nocontent_create">
                     Click to create a new document authority.
                 </p>
             </field>
         </record>

        <menuitem name="Indent Management" parent="stock.menu_stock_configuration" id="menu_indent_configuration" sequence="41"/>
        <menuitem action="action_document_authority" name="Document Authorities" parent="menu_indent_configuration" id="menu_document_authority" sequence="2"/>

        <!-- Stock Picking Form View -->
        <record id="view_stock_picking_form" model="ir.ui.view">
            <field name="name">stock.picking.form.inherit</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_form"/>
            <field name="arch" type="xml">
                <field name="origin" position="replace">
                    <field name="origin" invisible="1"/>
                    <field name="indent_id" invisible="1"/>
                    <field name="indentor_id" invisible="1"/>
                    <field name="indent_date" invisible="1"/>
                    <field name="maize" groups="indent.group_maize_data"/>
                </field>
                <xpath expr="//button[@name='draft_validate']" position="replace"/>
                <button name="force_assign" position="attributes">
                    <attribute name="string">Approve</attribute>
                </button>
                <xpath expr="//notebook/page[@string='Additional Info']" position="after">
                    <page string="Status">
                        <field name="picking_authority_ids" readonly="1">
                            <tree string="Status" editable="bottom">
                                <field name="date"/>
                                <field name="name"/>
                                <field name="priority"/>
                                <field name="description"/>
                                <field name="state"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- Stock Move Form View -->
        <record id="view_indent_move_form" model="ir.ui.view">
            <field name="name">indent.move.form</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//group[@string='Traceability']" position="after">
                    <group string="Indent">
                        <field name="indent"/>
                        <field name="indentor"/>
                    </group>
                </xpath>
            </field>
        </record>

        <!-- Purchase Order Form View -->
        <record id="view_purchase_order_form" model="ir.ui.view">
            <field name="name">purchase.order.form.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//sheet/div/h1/field[@name='name']" position="after">
                    <field name="contract_name"/>
                </xpath>
                <field name="origin" position="replace">
                    <field name="origin" invisible="1"/>
                    <field name="indent_id" invisible="1"/>
                    <field name="indentor_id" invisible="1"/>
                    <field name="indent_date" invisible="1"/>
                    <field name="maize" groups="indent.group_maize_data"/>
                </field>
                <xpath expr="//field[@name='order_line']/tree/field[@name='name']" position="after">
                    <field name="indent_id" readonly="1"/>
                    <field name="indentor_id" readonly="1"/>
                </xpath>
            </field>
        </record>

        <!-- Purchase Requisition Form View -->
        <record id="view_purchase_requisition_inherited_form" model="ir.ui.view">
            <field name="name">purchase.requisition.form.inherit</field>
            <field name="model">purchase.requisition</field>
            <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_form"/>
            <field name="arch" type="xml">
                <field name="exclusive" position="after">
                    <field name="indent_id"/>
                    <field name="indentor_id"/>
                    <field name="indent_date"/>
                    <field name="maize" groups="indent.group_maize_data"/>
                </field>
            </field>
        </record>

        <!-- User's Signature Form View -->
        <record id="view_res_users_signature_form" model="ir.ui.view">
            <field name="name">res.users.signature.form</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form"/>
            <field name="arch" type="xml">
                <xpath expr="//notebook/page[@string='Access Rights']" position="after">
                    <page string="Signature">
                        <group>
                            <field name="sign" widget='image' class="oe_left oe_avatar"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- Employee Form View -->
        <record id="view_hr_employee_form_inherited" model="ir.ui.view">
            <field name="name">hr.employee.form.inherited</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_form"/>
            <field name="arch" type="xml">
                <field name="category_ids" position="after">
                    <label for="absent"/>
                    <field name="absent"/>
                </field>
            </field>
        </record>

        <!-- Partner Search View -->
        <record id="view_res_partner_inherited_search" model="ir.ui.view">
            <field name="name">res.partner.inherited.search</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
               <field name="name" position="replace">
                    <field name="name"
                       filter_domain="['|', '|', '|', ('name', 'ilike', self), ('parent_id', 'ilike', self), ('ref', '=', self), ('supp_code', '=', self)]"/>
                </field>
            </field>
        </record>

        <!-- Product Form View -->
        <record id="view_maize_product_product_form" model="ir.ui.view">
            <field name="name">maize.product.product.form</field>
            <field name="model">product.product</field>
            <field name="inherit_id" ref="stock.view_normal_procurement_locations_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='%(stock.action_view_change_product_quantity)d']" position="attributes">
                    <attribute name="groups">indent.group_maize_data</attribute>
                </xpath>
            </field>
        </record>

        <!-- Stock Location Form View -->
        <record id="view_maize_stock_location_form" model="ir.ui.view">
            <field name="name">maize.stock.location.form</field>
            <field name="model">stock.location</field>
            <field name="inherit_id" ref="stock.view_location_form"/>
            <field name="arch" type="xml">
                <xpath expr="//group[@string='Localization']" position="after">
                    <group string="Maize">
                        <field name="seq_id" readonly="1"/>
                        <field name="seq_type_id" readonly="1"/>
                        <field name="maize_location"/>
                    </group>
                </xpath>
            </field>
        </record>

    </data>
</openerp>
