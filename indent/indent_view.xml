<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <!-- Purchase Order Search View -->
        <record id="view_purchase_order_inherited_search" model="ir.ui.view">
            <field name="name">purchase.order.search.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
            <field name="arch" type="xml">
               <filter string="Source" position="attributes">
                    <attribute name="string">Indent</attribute>
                </filter>
               <field name="create_uid" position="after">
                    <field name="indent_id"/>
                </field>
            </field>
        </record>

        <!-- Purchase Order Link with Indent action -->
        <record model="ir.actions.act_window" id="action_purchase_order_indent_view">
            <field name="context">{'search_default_indent_id': active_id}</field>
            <field name="name">Purchase Order</field>
            <field name="res_model">purchase.order</field>
            <field name="search_view_id" ref="view_purchase_order_inherited_search"/>
        </record>

        <!-- Purchase Requisition Search View -->
        <record id="view_purchase_requisition_inherited_search" model="ir.ui.view">
            <field name="name">purchase.requisition.search.inherit</field>
            <field name="model">purchase.requisition</field>
            <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_filter"/>
            <field name="arch" type="xml">
                <field name="user_id" position="after">
                    <field name="indent_id"/>
                </field>
            </field>
        </record>

        <!-- Purchase Requisiton Link with Indent action -->
        <record model="ir.actions.act_window" id="action_purchase_requisition_indent_view">
            <field name="context">{'search_default_indent_id': active_id}</field>
            <field name="name">Purchase Requisition</field>
            <field name="res_model">purchase.requisition</field>
            <field name="search_view_id" ref="view_purchase_requisition_inherited_search"/>
        </record>

        <!-- Indent Form View -->
        <record id='view_indent_indent_form' model='ir.ui.view'>
            <field name="name">indent.indent.form</field>
            <field name="model">indent.indent</field>
            <field name="arch" type="xml">
                <form string="Indents" version="7.0">
                    <header>
                        <button name="indent_confirm" string="Confirm" states="draft" class="oe_highlight"/>
                        <button name="indent_validate" string="Validate" states="confirm" class="oe_highlight"/>
                        <button name="indent_reject" string="Reject" states="confirm"/>
                        <button name="indent_inprogress" string="Approve" states="waiting_approval" class="oe_highlight"/>
                        <button name="indent_reject" string="Reject" states="waiting_approval"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirm,waiting_approval,inprogress,received" statusbar_colors='{"reject":"red"}'/>
                    </header>
                    <sheet>
                    	<div class="oe_title">
	                        <h1>
	                            <label for="name" class="oe_edit_only"/>
	                            <field name="name"/>
	                        </h1>
                        </div>
                                <field name="requisition_done" invisible="1"/>
                                <field name="purchase_count" invisible="1"/>
                               	<field name="shipment_done" invisible="1"/>
	                    <div class="oe_right oe_inline" name="buttons">
	  	                    <button name="%(action_purchase_requisition_indent_view)d" string="Enquiry" type="action" groups="purchase.group_purchase_user" states="inprogress,received"/> 
                            <button name="process_purchase_order" string="Process Purchase Orders" type="object" groups="purchase.group_purchase_user" attrs="{'invisible': ['|',('purchase_count', '=', True),('requisition_done','=',False)]}"/>
							<button name="action_receive_products" string="Inward" attrs="{'invisible': [('purchase_count', '=', False)]}" type="object"/>
                            <button name="action_issue_receipt" string="Issue Reciept(s)" attrs="{'invisible': [('shipment_done','=',False)]}" type="object" groups="purchase.group_purchase_user"/>  
	                        <button name="%(action_purchase_order_indent_view)d" string="Purchase Orders" type="action" groups="purchase.group_purchase_user" attrs="{'invisible': [('purchase_count','=',False)]}"/>
	                        	
                        </div>
                        <group>
                            <group>
                                <field name="indent_date"/>
                            </group>
                            <group>
                                <field name="required_date"/>
                            </group>
                        </group>
                        <group string="Indent Details">
                            <group>
                                <field name="indentor_id"/>
                                <field name="employee_id" invisible="1"/>
                                <field name="employee_department_id" invisible="1"/>
                                <field name="department_id"/>
                                <field name="analytic_account_id"/>
                            </group>
                            <group>
                                <field name="requirement"/>
                                <field name="type"/>
                                <field name="company_id"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Products">
                                <field name="product_lines">
                                    <form string="Products" version="7.0">
                                        <group>
                                            <group>
                                                <field name="product_id"
                                                    groups="base.group_user"
                                                    on_change="product_id_change(product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.indent_date)"/>
                                                <label for="product_uom_qty"/>
                                                <div>
                                                    <field
                                                        name="product_uom_qty" class="oe_inline"
                                                        on_change="product_id_change(product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name, parent.indent_date)"/>
                                                    <field name="product_uom" groups="product.group_uom" class="oe_inline oe_no_button"
                                                        on_change="product_uom_change(product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name, parent.indent_date)"/>
                                                </div>
                                                <label for="product_uos_qty" groups="product.group_uos"/>
                                                <div groups="product.group_uos">
                                                    <field name="product_uos_qty" class="oe_inline"/>
                                                    <field name="product_uos" options='{"no_open": True}' class="oe_inline"/>
                                                </div>
                                            </group>
                                            <group>
                                                <field name="type"/>
                                                <field name="qty_available"/>
                                                <field name="virtual_available"/>
                                            </group>
                                        </group>
                                        <label for="name"/>
                                        <field name="name"/>
                                        <label for="specification"/>
                                        <field name="specification"/>
                                    </form>
                                    <tree string="Products">
                                        <field name="product_id"
                                            groups="base.group_user"
                                            on_change="product_id_change(product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.indent_date)"/>
                                        <field name="product_uom" string="Unit"
                                            on_change="product_uom_change(product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.indent_date)"
                                            groups="product.group_uom" options='{"no_open": True}'/>
                                        <field name="qty_available"/>
                                        <field name="product_uom_qty"
                                            on_change="product_id_change(product_id, product_uom_qty, product_uom, product_uos_qty, product_uos, name, parent.indent_date)"/>
                                        <field name="product_uos_qty" groups="product.group_uos" invisible="1"/>
                                        <field name="product_uos" string="UoS" groups="product.group_uos" invisible="1"/>
                                        <field name="name"/>
                                        <field name="specification"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Status">
                                <field name="indent_authority_ids" readonly="1">
                                    <tree string="Status" editable="bottom">
                                        <field name="date"/>
                                        <field name="name"/>
                                        <field name="priority"/>
                                        <field name="description"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                        <label for="description"/>
                        <field name="description"/>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Indent Tree View -->
        <record id='view_indent_indent_tree' model='ir.ui.view'>
            <field name="name">indent.indent.tree</field>
            <field name="model">indent.indent</field>
            <field name="arch" type="xml">
                <tree string="Indents" colors="gray:state=='received';red:shipment_done==True;green:purchase_count==True;">
                    <field name="name"/>
                    <field name="indentor_id"/>
                    <field name="indent_date"/>
                    <field name="required_date"/>
                    <field name="department_id"/>
                    <field name="analytic_account_id"/>
                    <field name="requirement"/>
                    <field name="type"/>
                    <field name="shipment_done" invisible="1"/>
                    <field name="purchase_count" invisible="1"/>
                    <field name="requisition_done" invisible="1"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Indent Search View -->
        <record id="view_indent_indent_search" model="ir.ui.view">
            <field name="name">indent.indent.search</field>
            <field name="model">indent.indent</field>
            <field name="arch" type="xml">
                <search string="Indents">
                    <field name="name" string="Indent Name"/>
                    <field name="indent_date"/>
                    <field name="required_date"/>
                    <filter string="Draft" name="state_draft" domain="[('state','=','draft')]"/>
                    <filter string="Confirm" name="state_confirm" domain="[('state','=','confirm')]"/>
                    <filter string="Waiting For Approval" name="state_waiting_approval" domain="[('state','=','waiting_approval')]"/>
                    <filter string="Inprogress" name="state_inprogress" domain="[('state','=','inprogress')]"/>
                    <filter string="Received" name="state_received" domain="[('state','=','received')]"/>
                    <filter string="Rejected" name="state_reject" domain="[('state','=','reject'),('active','=',False)]"/>
                    <field name="indentor_id"/>
                    <field name="department_id"/>
                    <field name="analytic_account_id"/>
                    <group expand="0" string="Group By...">
                        <filter string="Indentor" context="{'group_by': 'indentor_id'}"/>
                        <filter string="Department" context="{'group_by': 'department_id'}"/>
                        <filter string="Project" context="{'group_by': 'analytic_account_id'}"/>
                        <filter string="Requirement" context="{'group_by': 'requirement'}"/>
                        <filter string="Indent Type" context="{'group_by': 'type'}"/>
                        <filter string="Status" context="{'group_by': 'state'}"/>
                        <filter string="Date" context="{'group_by': 'indent_date'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Indent Action -->
        <record id='action_indent_indent' model='ir.actions.act_window'>
            <field name="name">Indents</field>
            <field name="res_model">indent.indent</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to create a new indent.
                </p>
            </field>
        </record>

        <!-- Indent Menu -->
        <menuitem name="Indents" parent="stock.menu_stock_root" id="menu_indent_indent_main" sequence="1"/>
        <menuitem action="action_indent_indent" name="Indents" parent="menu_indent_indent_main" id="menu_indent_indent" sequence="1"/>
        <menuitem id="stock.menu_stock_warehouse_mgmt" name="Receive/Deliver By Orders" parent="stock.menu_stock_root" sequence="2"/>
        <menuitem id="stock.menu_stock_products_moves" name="Receive/Deliver Products" parent="stock.menu_stock_root" sequence="3"/>

        <menuitem name="Indent Management" parent="stock.menu_stock_configuration" id="menu_indent_configuration" sequence="41"/>
        <!--
        <menuitem action="action_document_authority" name="Document Authorities" parent="menu_indent_configuration" id="menu_document_authority" sequence="2"/>
        -->

        <!-- Stock Picking Form View -->
        <record id="view_stock_picking_form" model="ir.ui.view">
            <field name="name">stock.picking.form.inherit</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_form"/>
            <field name="arch" type="xml">
                <field name="origin" position="replace">
                    <field name="origin" invisible="1"/>
                    <field name="indent_id"/>
                    <field name="indentor_id"/>
                    <field name="indent_date"/>
                </field>
                <xpath expr="//button[@name='draft_force_assign']" position="before">
                    <button name="button_approve" states="draft" string="Approved by manager" class="oe_highlight"/>
                </xpath>
                <xpath expr="//button[@name='draft_force_assign']" position="replace">
                    <button name="draft_force_assign" states="approved" string="Confirm" type="object" class="oe_highlight" groups="base.group_user"/>
                </xpath>
                <xpath expr="//button[@name='draft_validate']" position="replace">
                    <button name="draft_validate" states="approved" string="Confirm &amp; Transfer" type="object" class="oe_highlight" groups="base.group_user"/>
                </xpath>
            </field>
        </record>
        
        <!-- Stock Picking In Form Inherit View -->
        <record id="view_stock_picking_in_inherit_form" model="ir.ui.view">
            <field name="name">stock.picking.in.inherit</field>
            <field name="model">stock.picking.in</field>
            <field name="inherit_id" ref="stock.view_picking_in_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='draft_force_assign']" position="before">
                    <button name="button_approve" states="draft" string="Approved by manager" class="oe_highlight"/>
                </xpath>
                <xpath expr="//button[@name='draft_force_assign']" position="replace">
                    <button name="draft_force_assign" states="approved" string="Confirm" type="object" class="oe_highlight" groups="base.group_user"/>
                </xpath>
                <xpath expr="//button[@name='draft_validate']" position="replace">
                    <button name="draft_validate" states="approved" string="Confirm &amp; Transfer" type="object" class="oe_highlight" groups="base.group_user"/>
                </xpath>
            </field>
        </record>

        <!-- Stock Picking Out Form Inherit View -->
        <record id="view_stock_picking_out_inherit_form" model="ir.ui.view">
            <field name="name">stock.picking.out.inherit</field>
            <field name="model">stock.picking.out</field>
            <field name="inherit_id" ref="stock.view_picking_out_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='draft_force_assign']" position="before">
                    <button name="button_approve" states="draft" string="Approved by manager" class="oe_highlight"/>
                </xpath>
                <xpath expr="//button[@name='draft_force_assign']" position="replace">
                    <button name="draft_force_assign" states="approved" string="Confirm" type="object" class="oe_highlight" groups="base.group_user"/>
                </xpath>
                <xpath expr="//button[@name='draft_validate']" position="replace">
                    <button name="draft_validate" states="approved" string="Confirm &amp; Transfer" type="object" class="oe_highlight" groups="base.group_user"/>
                </xpath>
            </field>
        </record> 

        <!-- Purchase Order Form View -->
        <record id="view_purchase_order_form" model="ir.ui.view">
            <field name="name">purchase.order.form.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <field name="origin" position="replace">
                    <field name="origin" invisible="1"/>
                    <field name="indent_id"/>
                    <field name="indentor_id"/>
                    <field name="indent_date"/>
                </field>
            </field>
        </record>

        <!-- Purchase Requisition Form View -->
        <record id="view_purchase_requisition_inherited_form" model="ir.ui.view">
            <field name="name">purchase.requisition.form.inherit</field>
            <field name="model">purchase.requisition</field>
            <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_form"/>
            <field name="arch" type="xml">
                <field name="exclusive" position="after">
                    <field name="indent_id"/>
                    <field name="indentor_id"/>
                    <field name="indent_date"/>
                </field>
            </field>
        </record>
    </data>
</openerp>
