-
  I create a Purchase Order
-
  !record {model: purchase.order, id: purchase_order_1}:
    partner_id: base.res_partner_3
    invoice_method: 'order'
    inward_freight: 5.0
    order_line:
      - product_id: product.product_product_48
        product_qty: 1.0
        price_unit: 13.0
-
  I confirm the purchase order
-
  !workflow {model: purchase.order, ref: purchase_order_1, action: purchase_confirm}
-
 In order to test the PDF reports defined on an invoice, we will print an Invoice Report
-
  !python {model: account.invoice}: |
    import netsvc, tools, os
    purchase_order_obj = self.pool.get('purchase.order').browse(cr,uid,ref('purchase_order_1'))
    invoice_id = self.search(cr,uid,[('partner_id','=',purchase_order_obj.partner_id.id),('origin','=',purchase_order_obj.name)])
    (data, format) = netsvc.LocalService('report.account.invoice').create(cr, uid, invoice_id, {}, {})
    if tools.config['test_report_directory']:
        file(os.path.join(tools.config['test_report_directory'], 'account-invoice.'+format), 'wb+').write(data)
